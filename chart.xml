<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             id="LangGraphGeneContextFlow"
             targetNamespace="http://example.com/bpmn">

  <process id="GeneContextPipeline" name="LangGraph Gene Context Pipeline" isExecutable="false">

    <startEvent id="StartEvent" name="User Input" />

    <task id="ExtractGenes" name="Extract Gene Names with Claude Haiku">
      <documentation>Identify gene names from user input</documentation>
    </task>

    <task id="QueryUniProt" name="Query UniProt">
      <documentation>Extract disease, GO terms, and function annotations</documentation>
    </task>

    <task id="QueryHumanBase" name="Query HumanBase">
      <documentation>Fetch high-confidence functional annotations</documentation>
    </task>

    <task id="BuildContext" name="Build Context Block">
      <documentation>Combine HumanBase and UniProt data into compact input</documentation>
    </task>

    <task id="AskSonnet" name="Query Claude Sonnet">
      <documentation>Ask model to answer based only on the provided context</documentation>
    </task>

    <task id="VerifyAnswer" name="Verify Answer with Claude Haiku">
      <documentation>Check if evidence supports conclusion; retry up to 3 times</documentation>
    </task>

    <endEvent id="ReturnOutput" name="Return Final Answer" />

    <!-- Linear flow -->
    <sequenceFlow id="flow1" sourceRef="StartEvent" targetRef="ExtractGenes"/>
    <sequenceFlow id="flow2" sourceRef="ExtractGenes" targetRef="QueryUniProt"/>
    <sequenceFlow id="flow3" sourceRef="QueryUniProt" targetRef="QueryHumanBase"/>
    <sequenceFlow id="flow4" sourceRef="QueryHumanBase" targetRef="BuildContext"/>
    <sequenceFlow id="flow5" sourceRef="BuildContext" targetRef="AskSonnet"/>
    <sequenceFlow id="flow6" sourceRef="AskSonnet" targetRef="VerifyAnswer"/>
    <sequenceFlow id="flow7" sourceRef="VerifyAnswer" targetRef="ReturnOutput"/>

  </process>

</definitions>

